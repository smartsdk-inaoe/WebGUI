{{extend 'kurentolayout.html'}}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
   integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
   crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
   integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
   crossorigin=""></script>
<style>
#mapid { height: 480px; }
</style>
<h3>Map</h3>
<div class="container col-sm-12 justify-content-center" id="mapid"></div>
<script>
var MyCustomMarker = L.Marker.extend({
     bindPopup: function(htmlContent, options) {
		if (options && options.showOnMouseOver) {
			// call the super method
			L.Marker.prototype.bindPopup.apply(this, [htmlContent, options]);
			// unbind the click event
			this.off("click", this.openPopup, this);
			// bind to mouse over
			this.on("mouseover", function(e) {
				// get the element that the mouse hovered onto
				var target = e.originalEvent.fromElement || e.originalEvent.relatedTarget;
				var parent = this._getParent(target, "leaflet-popup");
				// check to see if the element is a popup, and if it is this marker's popup
				if (parent == this._popup._container)
					return true;
				// show the popup
				this.openPopup();
			}, this);
			// and mouse out
			this.on("mouseout", function(e) {
				// get the element that the mouse hovered onto
				var target = e.originalEvent.toElement || e.originalEvent.relatedTarget;
				// check to see if the element is a popup
				if (this._getParent(target, "leaflet-popup")) {
					L.DomEvent.on(this._popup._container, "mouseout", this._popupMouseOut, this);
					return true;
				}
				// hide the popup
				this.closePopup();
			}, this);
		}
	},

	_popupMouseOut: function(e) {
		// detach the event
		L.DomEvent.off(this._popup, "mouseout", this._popupMouseOut, this);
		// get the element that the mouse hovered onto
		var target = e.toElement || e.relatedTarget;
		// check to see if the element is a popup
		if (this._getParent(target, "leaflet-popup"))
			return true;
		// check to see if the marker was hovered back onto
		if (target == this._icon)
			return true;
		// hide the popup
		this.closePopup();
	},

	_getParent: function(element, className) {
		var parent = element.parentNode;
		while (parent != null) {
			if (parent.className && L.DomUtil.hasClass(parent, className))
				return parent;
			parent = parent.parentNode;
		}
		return false;
	}
});

var mymap = L.map('mapid').setView([19.03339, -98.31622],19);
L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'OpenStreetMap',
    maxZoom: 19
}).addTo(mymap);

var markers = new L.FeatureGroup();

//var marker1 = L.marker();
//var marker2 = L.marker();
//var marker3 = L.marker();
//var marker4 = L.marker();

function updateMarkers() {
    //Camera 1
    var marker1 = new MyCustomMarker([19.03353, -98.31621]);
    marker1.bindPopup("<b>Camera name:</b> Hallway<br><b>Detections:</b> #<br><b>Other info:</b> #", 
						{ showOnMouseOver: true });
    markers.addLayer(L.polygon([
            [19.03353, -98.31621],
            [19.03366, -98.31615],
            [19.03363, -98.31610]
        ]));
	markers.addLayer(marker1);
    //Camera 2
    var marker2 = new MyCustomMarker([19.03171, -98.31600]);
    marker2.bindPopup("<b>Camera name:</b> Main Entrance<br><b>Detections:</b> #<br><b>Other info:</b> #", 
						{ showOnMouseOver: true });
    markers.addLayer(L.polygon([
            [19.03171, -98.31600],
            [19.03156, -98.31616],
            [19.03167, -98.31622]
        ]));
	markers.addLayer(marker2);
    //Camera 3
    var marker3 = new MyCustomMarker([19.03139, -98.31694]);
    marker3.bindPopup("<b>Camera name:</b> Parking Entrance<br><b>Detections:</b> #<br><b>Other info:</b> #", 
						{ showOnMouseOver: true });
    markers.addLayer(L.polygon([
            [19.03139, -98.31694],
            [19.03143, -98.31707],
            [19.03150, -98.31697]
        ]));
	markers.addLayer(marker3);
    //Camera 4
    var marker4 = new MyCustomMarker([19.03077, -98.31637]);
    marker4.bindPopup("<b>Camera name:</b> Parking Lot<br><b>Detections:</b> #<br><b>Other info:</b> #", 
						{ showOnMouseOver: true });
    markers.addLayer(L.polygon([
            [19.03077, -98.31637],
            [19.03086, -98.31693],
            [19.03113, -98.31677]
        ]));
	markers.addLayer(marker4);
    mymap.flyTo([19.0322,-98.31605],17);
}

function getClickCoordinates(e) {
    alert("You clicked the map at " + e.latlng);
}

mymap.on('click', updateMarkers);
//marker1.on('click', marker1.getPopup().openPopup());
//marker2.on('click', marker2.getPopup().openPopup());
//marker3.on('click', marker3.getPopup().openPopup());
//marker4.on('click', marker4.getPopup().openPopup());
mymap.addLayer(markers);
</script>
